# 職員朝礼伝達システム (v7.0)

教員の朝礼で使用する伝達事項・予定管理システム

## 概要

このシステムは、学校の教員が朝礼で共有する情報を一元管理するための Google Apps Script ベースの Web アプリケーションです。

### 主な機能

- **行事管理**: 日々の学校行事の登録・表示
- **出張・休暇管理**: 教職員の出張や休暇情報の管理
- **会議管理**: 定例会議と個別会議の管理
- **伝達事項**: 職員向けと生徒向けの伝達事項の管理
- **特別教室予約**: 教室の予約状況をマトリックス表示

## バージョン 7.0 での改善点

### 1. コード品質の向上

#### バックエンド (Code.js)
- **エラーハンドリング**: すべての主要関数にtry-catchブロックを追加
- **ログ機能**: 詳細なログ記録機能を実装（logError, logInfo）
- **データバリデーション**: 入力データの検証機能を追加
- **JSDocコメント**: すべての関数に詳細なドキュメンテーションを追加
- **エラーメッセージの一元管理**: ERROR_MESSAGES定数で管理

#### フロントエンド (js.html)
- **XSS対策**: escapeHtml関数を実装してセキュリティを強化
- **エラー表示の改善**: alert()からトーストメッセージへ移行
- **成功メッセージの追加**: データ保存・削除時のフィードバックを改善
- **コードの整理**: 機能ごとにセクション分けとドキュメント化
- **バリデーション**: フォーム送信前の入力チェックを強化

### 2. 設定管理の改善 (Config.js)

- システム設定の一元管理
- セキュリティに関するコメントの追加
- バージョン管理の導入

### 3. UI/UX の改善

- **トーストメッセージ**: 操作結果を視覚的に分かりやすく表示
- **アクセシビリティ**: ARIA属性の追加
- **印刷スタイル**: 印刷時の表示を最適化
- **日本語フォント対応**: フォントファミリーを日本語に最適化

### 4. 保守性の向上

- **コメントとドキュメント**: すべてのファイルに適切なコメントを追加
- **定数の一元管理**: CONFIG、MESSAGE などの定数オブジェクトで管理
- **関数の分割**: 大きな関数を小さく分割して可読性を向上
- **エラーログ**: console.errorでデバッグを容易化

## ファイル構成

```
syokutyo/
├── Code.js           # バックエンドロジック（Google Apps Script）
├── Config.js         # システム設定
├── index.html        # メインHTMLテンプレート
├── js.html           # JavaScriptコード
├── css.html          # スタイルシート
├── メモ.js           # データ構造のドキュメント
├── appsscript.json   # Apps Script設定
├── .clasp.json       # Clasp設定
└── README.md         # このファイル
```

## セットアップ

### 1. 前提条件

- Google アカウント
- Google Apps Script へのアクセス権限
- Node.js と npm（clasp を使用する場合）

### 2. スプレッドシートの準備

以下のシートを持つ Google Spreadsheet を作成してください：

1. **職員情報** - id, name, role, display_order
2. **行事** - id, date, time, content, note
3. **出張等** - id, date, staff_name, purpose, location, time, note
4. **休暇等** - id, date, staff_name, type, time, note
5. **会議** - id, date, meeting_name, time, place
6. **伝達事項** - id, date, type, priority, target, content, reporter
7. **特別教室予約** - id, date, room_name, period, content, reserver
8. **定例会議** - day_of_week, meeting_name, time, place
9. **特別教室固定** - day_of_week, period, room_name, content, reserver

### 3. 設定

1. `Config.js` を開く
2. `SPREADSHEET_ID` をあなたのスプレッドシートのIDに変更
   - スプレッドシートのURL: `https://docs.google.com/spreadsheets/d/【ここがID】/edit`

### 4. デプロイ

#### 方法1: Google Apps Script エディタから

1. スクリプトエディタを開く
2. すべてのファイルをコピー＆ペースト
3. 「デプロイ」→「新しいデプロイ」
4. 種類: ウェブアプリ
5. 実行ユーザー: 自分
6. アクセスできるユーザー: ドメイン内のユーザー（または適切な設定）

#### 方法2: clasp を使用

```bash
npm install -g @google/clasp
clasp login
clasp push
clasp deploy
```

## 使い方

### データの追加

1. 各セクションの「追加」ボタンをクリック
2. モーダルフォームに必要事項を入力
3. 「保存」をクリック

### データの削除

- 各項目の削除ボタン（ゴミ箱アイコン）をクリック
- 確認ダイアログで「OK」を選択

### 教室予約

- 空きセルをクリックして予約
- 固定予約のセル（🔒マーク）をクリックして本日分を変更
- 予約済みセルをクリックして削除

### 行事情報のコピー

- 行事セクションのコピーボタンをクリック
- クリップボードにテキスト形式でコピーされます

## セキュリティ

### 重要な注意事項

1. **スプレッドシートID**: `Config.js` の `SPREADSHEET_ID` は機密情報です
2. **共有設定**: スプレッドシートの共有設定を適切に管理してください
3. **デプロイ設定**: 適切なユーザーのみがアクセスできるように設定してください

### セキュリティ機能

- XSS対策: すべてのユーザー入力をエスケープ処理
- 入力バリデーション: バックエンドとフロントエンドで二重チェック
- エラーハンドリング: 適切なエラーメッセージで情報漏洩を防止

## トラブルシューティング

### データが読み込まれない

1. ブラウザのコンソールでエラーを確認
2. `Config.js` の `SPREADSHEET_ID` が正しいか確認
3. スプレッドシートの共有設定を確認

### 保存できない

1. 必須フィールドがすべて入力されているか確認
2. ネットワーク接続を確認
3. Apps Script のログを確認

### エラーメッセージが表示される

- エラーメッセージの内容を確認
- ブラウザのコンソールで詳細なエラーログを確認
- デバッグモードを有効にする（`Config.js` の `DEBUG_MODE = true`）

## 開発

### ローカル開発環境

```bash
# claspのインストール
npm install -g @google/clasp

# ログイン
clasp login

# プロジェクトのクローン
clasp clone [スクリプトID]

# 変更をプッシュ
clasp push
```

### デバッグ

- `Config.js` で `DEBUG_MODE = true` に設定
- ブラウザの開発者ツールでコンソールログを確認
- Apps Script のログビューアーで サーバーサイドのログを確認

## 今後の改善予定

- [ ] データのエクスポート機能
- [ ] 検索・フィルター機能
- [ ] 通知機能
- [ ] モバイル対応の強化
- [ ] ダークモード対応
- [ ] 多言語対応

## ライセンス

このプロジェクトは教育目的で作成されています。

## 更新履歴

### v7.0 (2025-12-10)
- コード品質の大幅な改善
- エラーハンドリングとバリデーションの強化
- UI/UXの改善（トーストメッセージ、アクセシビリティ）
- セキュリティの強化（XSS対策）
- ドキュメンテーションの充実

### v6.0
- 初期バージョン