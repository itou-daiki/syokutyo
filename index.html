<!DOCTYPE html>
<html lang="ja">

<head>
  <base target="_top">
  <meta charset="utf-8">
  <title>職員朝礼伝達システム</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <?!= include('css'); ?>
</head>

<body>

  <div id="loading" class="loading-overlay" style="display: none;">
    <div class="spinner-border text-primary" role="status"></div>
  </div>

  <nav class="navbar sticky-top">
    <div class="container-fluid d-flex align-items-center justify-content-between">
      <div class="d-flex align-items-center">
        <a class="navbar-brand d-flex align-items-center gap-2" href="#">
          <i class="bi bi-journal-text"></i>
          <span class="d-none d-sm-inline">朝礼伝達</span>
        </a>


      </div>

      <div class="date-controller d-flex align-items-center">
        <button class="btn-nav-arrow" onclick="changeDate(-1)">＜</button>

        <div class="mx-2" style="display: inline-block;">
          <label for="datePicker" id="navDateDisplay" style="cursor: pointer; min-width: 140px; text-align: center; display:block; padding: 4px 8px; user-select: none;">
            Loading...
          </label>
          <input type="date" id="datePicker"
            style="position: absolute; left: -9999px; width: 1px; height: 1px;"
            onchange="onDatePickerChange()">
        </div>

        <button class="btn-nav-arrow" onclick="changeDate(1)">＞</button>
      </div>

      <div class="d-flex align-items-center gap-2">

        <button class="btn btn-sm btn-outline-primary rounded-circle" style="width:36px;height:36px;"
          onclick="loadData(true)" title="更新"><i class="bi bi-arrow-clockwise"></i></button>
        <div id="weatherInfo"></div>
      </div>
    </div>
  </nav>

  <div class="container-fluid pt-4">

    <div class="row g-4 mb-4">
      <div class="col-lg-6">
        <div class="card h-100">
          <div class="card-header header-primary">
            <div class="header-title-wrapper">
              <i class="bi bi-calendar-check-fill"></i>
              <span>本日の行事</span>
              <span id="headerTodayInfo" class="header-meta"></span>
            </div>
            <button class="btn btn-sm btn-light text-primary" onclick="openModal('daily')"><i
                class="bi bi-plus-lg"></i></button>
          </div>
          <div class="card-body p-0 card-body-scroll">
            <ul class="list-group list-group-flush" id="dailyList"></ul>
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card h-100">
          <div class="card-header header-info">
            <div class="header-title-wrapper">
              <i class="bi bi-calendar-plus"></i>
              <span>明日の行事</span>
              <span id="headerTomorrowInfo" class="header-meta"></span>
            </div>
            <button class="btn btn-sm btn-light text-info" onclick="openModalForTomorrow('daily')"><i
                class="bi bi-plus-lg"></i></button>
          </div>
          <div class="card-body p-0 card-body-scroll">
            <ul class="list-group list-group-flush" id="dailyListTomorrow"></ul>
          </div>
        </div>
      </div>
    </div>

    <div class="row g-4 mb-4">
      <div class="col-lg-6">
        <div class="card h-100">
          <div class="card-header header-secondary">
            <div class="header-title-wrapper">
              <i class="bi bi-people-fill"></i>
              <span>本日の会議</span>
              <span id="headerMeetingInfo" class="header-meta"></span>
            </div>
            <button class="btn btn-sm btn-light text-secondary" onclick="openModal('meeting')"><i
                class="bi bi-plus-lg"></i></button>
          </div>
          <div class="card-body p-0 card-body-scroll">
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <tbody id="meetingListMain"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card h-100 border-warning" style="border-left: 5px solid #f59e0b;">
          <div class="card-header" style="background: #fffbeb; color: #b45309;">
            <div class="header-title-wrapper">
              <i class="bi bi-check-circle-fill"></i>
              <span>タスク</span>
              <span id="headerTaskInfo" class="header-meta">0件</span>
            </div>
            <button class="btn btn-sm btn-light text-warning" onclick="openModal('task')"><i
                class="bi bi-plus-lg"></i></button>
          </div>
          <div class="card-body p-0 card-body-scroll">
            <ul class="list-group list-group-flush" id="taskList">
              <li class="list-group-item text-center text-muted py-4">タスクなし</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="row g-4 mb-4">
      <div class="col-lg-6">
        <div class="card h-100">
          <div class="card-header header-danger">
            <div class="header-title-wrapper">
              <i class="bi bi-megaphone-fill"></i>
              <span>伝達事項（職員）</span>
            </div>
            <button class="btn btn-sm btn-light text-danger" onclick="openModal('announce', '職員')"><i
                class="bi bi-plus-lg"></i></button>
          </div>
          <div class="card-body p-0 card-body-scroll">
            <ul class="list-group list-group-flush" id="announceStaffList"></ul>
          </div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="card h-100">
          <div class="card-header header-info">
            <div class="header-title-wrapper">
              <i class="bi bi-broadcast"></i>
              <span>伝達事項（生徒）</span>
            </div>
            <button class="btn btn-sm btn-light text-info" onclick="openModal('announce', '生徒')"><i
                class="bi bi-plus-lg"></i></button>
          </div>
          <div class="card-body p-0 card-body-scroll">
            <ul class="list-group list-group-flush" id="announceStudentList"></ul>
          </div>
        </div>
      </div>
    </div>

    <div class="row g-4 mb-4">
      <div class="col-lg-6">
        <div class="card h-100">
          <div class="card-header header-success">
            <div class="header-title-wrapper">
              <i class="bi bi-briefcase-fill"></i>
              <span>出張</span>
              <span id="headerTripInfo" class="header-meta"></span>
            </div>
            <button class="btn btn-sm btn-light text-success" onclick="openModal('trip')"><i
                class="bi bi-plus-lg"></i></button>
          </div>
          <div class="card-body p-0 card-body-scroll">
            <ul class="list-group list-group-flush" id="tripList"></ul>
          </div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="card h-100">
          <div class="card-header header-secondary">
            <div class="header-title-wrapper">
              <i class="bi bi-house-door-fill"></i>
              <span>休暇</span>
              <span id="headerLeaveInfo" class="header-meta"></span>
            </div>
            <button class="btn btn-sm btn-light text-secondary" onclick="openModal('leave')"><i
                class="bi bi-plus-lg"></i></button>
          </div>
          <div class="card-body p-0 card-body-scroll">
            <ul class="list-group list-group-flush" id="leaveList"></ul>
          </div>
        </div>
      </div>
    </div>

    <div class="card h-100 mb-4">
      <div class="card-header header-purple">
        <div class="header-title-wrapper">
          <i class="bi bi-grid-3x3"></i>
          <span>特別教室予約状況</span>
        </div>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table matrix-table mb-0" id="roomTable">
            <thead></thead>
            <tbody id="roomBody"></tbody>
          </table>
        </div>
      </div>
    </div>

  </div>

  <div class="modal fade" id="entryModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content shadow-lg">
        <div class="modal-header bg-light">
          <h5 class="modal-title fw-bold" id="modalTitle">登録</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body p-4">
          <form id="entryForm">
            <input type="hidden" id="entryCategory">
            <input type="hidden" id="entryId">
            <input type="hidden" id="announceType">
            <div id="formContent"></div>
          </form>
        </div>
        <div class="modal-footer bg-light border-0">
          <button type="button" class="btn btn-secondary rounded-pill px-4" data-bs-dismiss="modal">キャンセル</button>
          <button type="button" class="btn btn-primary rounded-pill px-4" onclick="submitForm()">保存</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="infoModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content shadow-lg">
        <div class="modal-header bg-white">
          <h5 class="modal-title fw-bold" id="infoModalTitle">詳細</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body p-4 text-start" id="infoModalBody"></div>
        <div class="modal-footer bg-white border-0">
          <button type="button" class="btn btn-secondary rounded-pill px-4" data-bs-dismiss="modal">閉じる</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <?!= include('js'); ?>
</body>

</html>